<!DOCTYPE html>
<html>
<head>
    <title>SprintGoal</title>

    <script type="text/javascript" src="https://rally1.rallydev.com/apps/2.1/sdk.js"></script>

    <script type="text/javascript">
        Rally.onReady(function () {
                !function(){var Ext=window.Ext4||window.Ext;Ext.define("CustomApp",{extend:"Rally.app.App",itemId:"rallyApp",stateful:!0,config:{defaultSettings:{recordType:"Iteration",field:"Theme",pointSize:28}},componentCls:"app",items:[{xtype:"container",itemId:"headerBox",layout:{type:"hbox"}},{xtype:"container",itemId:"textBox"}],textHTML:null,_enterMainApp:function(){var me=this;this.down("#itemSelector")&&this.down("#itemSelector").destroy();var typeSelected=me.typeSelector;return typeSelected?void this.down("#headerBox").add({xtype:typeSelected.comboBox,margin:"5 0 5 20",itemId:"itemSelector",fieldLabel:"Select Item: ",stateful:!0,stateId:"itemSelector"+Ext.id(),storeConfig:{autoLoad:!0,model:typeSelected.value,fetch:typeSelected.fetchList},listeners:{select:function(){me._checkState(this.store.config.model,me)},ready:function(){me._checkState(this.store.config.model,me)}}}):void this.add({xtype:"label",text:"Please set and save app settings for first use",margin:50,itemId:"settingsLabel"})},typeSelector:null,getSettingsFields:function(){var me=this,returned=[{xtype:"rallycombobox",margin:"5 0 5 20",bubbleEvents:["resetField"],name:"recordType",fieldLabel:"Artefact Type:",labelWidth:150,displayField:"name",valueField:"value",editable:!1,storeType:"Ext.data.Store",storeConfig:{remoteFilter:!1,fields:["name","value","comboBox","fetchList"],data:[{name:"Iteration",value:"Iteration",comboBox:"rallyiterationcombobox",fetchList:["Name","StartDate","EndDate","ObjectID","State","PlannedVelocity"]},{name:"Release",value:"Release",comboBox:"rallyreleasecombobox",fetchList:["Name","ObjectID","State","ReleaseDate","ReleaseStartDate"]},{name:"Milestone",value:"Milestone",comboBox:"rallymilestonecombobox",fetchList:["Name","ObjectID","TargetDate"]}]},listeners:{select:function(combo,records){me.typeSelector=records[0].data,combo.fireEvent("resetField",records[0].get("value"),combo.context)},ready:function(combo){me.typeSelector=this.getRecord().data,this.fireEvent("resetField",combo.value,combo.context)}}},{name:"field",fieldLabel:"Field: ",xtype:"rallyfieldcombobox",labelWidth:150,margin:"5 0 5 20",_isNotHidden:function(field){var blacklist=["ObjectUUID","ObjectID","Subscription","Workspace","UserIterationCapacities","RevisionHistory","Project","VersionId"];return!field.hidden&&!_.contains(blacklist,field.name)},handlesEvents:{resetField:function(type,context){this.refreshWithNewModelType(type,context)}}},{name:"pointSize",fieldLabel:"Font px: ",xtype:"rallytextfield",labelWidth:150,margin:"5 0 5 20",validateOnChange:!0,isValid:function(){return!(!this.getValue()||!parseInt(this.getValue()))}}];return returned},onSettingsUpdate:function(){this.down("#settingsLabel")&&this.down("#settingsLabel").destroy(),this._enterMainApp()},_checkState:function(model,me){if(me.down("#itemSelector")){var oid=Rally.util.Ref.getOidFromRef(me.down("#itemSelector").getValue());Ext.create("Rally.data.wsapi.Store",{model:model,autoLoad:!0,fetch:!0,filters:[{property:"ObjectID",operator:"=",value:oid}],listeners:{load:function(store,data,success){if(success){var hb=me.down("#textBox"),fieldName=me.getSetting("field"),fieldData=data[0].get(fieldName)?data[0].get(fieldName).toString():"Field Info Not Available",pointSize=me.getSetting("pointSize");hb&&hb.down("#labelBox")&&hb.down("#labelBox").destroy();var label=hb.add({xtype:"label",itemId:"labelBox",html:fieldData});label.getEl().setStyle("font-size",pointSize+"px")}}}},this)}},launch:function(){this._enterMainApp()}})}();

            Rally.launchApp('CustomApp', {
                name:"SprintGoal",
	            parentRepos:""
            });

        });
    </script>


    <style type="text/css">
        
    </style>
</head>
<body>
</body>
</html>
